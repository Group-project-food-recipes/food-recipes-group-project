<!DOCTYPE html>
<html lang="en" >

<head>
  	<meta charset="UTF-8">
  	<title>Login</title>
  	<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans:600'>
	<link rel="stylesheet" href="css/style.css" type="text/css">
	<meta name="google-signin-client_id" content="22604769740-maf2eq1ma41rfaj5i8id6vbb5nulqt8k.apps.googleusercontent.com">
	<script src="https://apis.google.com/js/platform.js" async defer></script>
	<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
</head>

<body>
  
	<script>
		$(document).ready( function(evet){
			signOut()
			$("#login").on("submit", function(event){
				event.preventDefault();
				var data ={
					email : $('#email').val(),
					password : $('#password').val()
				}
				$.ajax({
					type: 'POST',
					url: 'http://localhost:3000/login/',
					dataType: 'json',
					data: data
				})
				.done(function(dataLogin){
					console.log(dataLogin)
					localStorage.setItem('token', dataLogin.token)
					window.location.href = '/index.html';
				})
				.fail(function(error){
					console.log(error)
				})
			})
		})
		function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
                console.log('User signed out.');
			});
        }
        function onSignIn(googleUser) {
			var id_token = googleUser.getAuthResponse().id_token;
			statusChangeCallback(id_token)	
        }

        function statusChangeCallback(token){
            $.ajax({
                method: "POST",
                url: 'http://localhost:3000/googlesign',
                data: {token: token}
            })
            .done(function(dataLogin) {
				console.log(dataLogin)
				localStorage.setItem('token', dataLogin.token)
				alert("sudah login google")
				window.location.href = '/index.html';
            })
            .fail(function(error){
                console.log(error)
            })
        }
    </script>
</body>

</html>
